# üìä Analyse Compl√®te de l'Harmonisation des √âditeurs

## üéØ Objectif
Harmoniser tous les √©diteurs pour qu'ils aient exactement le m√™me syst√®me de modules, panneaux, interfaces, fonctionnalit√©s et comportements.

## üìÅ √âditeurs Identifi√©s

### 1. **DesignEditor** (`/src/components/DesignEditor/`)
- **Route**: `/design-editor`
- **Type**: √âditeur de design g√©n√©rique
- **Composants cl√©s**:
  - `DesignEditorLayout.tsx`
  - `HybridSidebar.tsx`
  - `DesignToolbar.tsx`
  - `DesignCanvas.tsx`
  - `MobileStableEditor.tsx`
  - `ZoomSlider.tsx`

### 2. **QuizEditor** (`/src/components/QuizEditor/`)
- **Route**: `/quiz-editor`
- **Type**: √âditeur de quiz
- **Composants cl√©s**:
  - `DesignEditorLayout.tsx`
  - `HybridSidebar.tsx`
  - `DesignToolbar.tsx`
  - `DesignCanvas.tsx`
  - `MobileStableEditor.tsx`
  - `ZoomSlider.tsx`
  - `QuizConfigPanel.tsx`
  - `QuizManagementPanel.tsx`

### 3. **ModelEditor** (`/src/components/ModelEditor/`)
- **Route**: `/model-editor`
- **Type**: Template de base pour nouveaux √©diteurs
- **Composants cl√©s**:
  - `DesignEditorLayout.tsx`
  - `HybridSidebar.tsx`
  - `DesignToolbar.tsx`
  - `DesignCanvas.tsx`
  - `MobileStableEditor.tsx`
  - `ZoomSlider.tsx`

### 4. **JackpotEditor** (`/src/components/JackpotEditor/`)
- **Route**: `/jackpot-editor`
- **Type**: √âditeur de jackpot/slot machine
- **Composants cl√©s**:
  - `JackpotEditorLayout.tsx`
  - `HybridSidebar.tsx`
  - `DesignToolbar.tsx`
  - `DesignCanvas.tsx`
  - `MobileStableEditor.tsx`
  - `ZoomSlider.tsx`

### 5. **ScratchCardEditor** (`/src/components/ScratchCardEditor/`)
- **Route**: `/scratch-card-editor`
- **Type**: √âditeur de cartes √† gratter
- **Composants cl√©s**:
  - `ScratchCardEditorLayout.tsx`
  - `HybridSidebar.tsx`
  - `DesignToolbar.tsx`
  - `DesignCanvas.tsx`
  - `MobileStableEditor.tsx`
  - `ZoomSlider.tsx`
  - `useScratchCardStore.ts`

## üîç Diff√©rences Identifi√©es

### A. **Imports et D√©pendances**

#### DesignEditor
```tsx
import { useLocation, useNavigate } from '@/lib/router-adapter';
import { useWheelConfigSync } from '../../hooks/useWheelConfigSync';
import PreviewRenderer from '@/components/preview/PreviewRenderer';
```

#### QuizEditor
```tsx
import { useLocation, useNavigate } from '@/lib/router-adapter';
import { useEditorPreviewSync } from '@/hooks/useEditorPreviewSync';
import PreviewRenderer from '@/components/preview/PreviewRenderer';
import { quizTemplates } from '../../types/quizTemplates';
// NO wheel config sync
```

#### ModelEditor
```tsx
import { useLocation, useNavigate } from 'react-router-dom'; // ‚ùå Diff√©rent!
import FunnelUnlockedGame from '@/components/funnels/FunnelUnlockedGame';
import EditorStateCleanup from '../EditorStateCleanup';
// NO wheel config sync
```

#### JackpotEditor & ScratchCardEditor
```tsx
import { useLocation, useNavigate } from 'react-router-dom'; // ‚ùå Diff√©rent!
import FunnelUnlockedGame from '@/components/funnels/FunnelUnlockedGame';
import FunnelQuizParticipate from '../funnels/FunnelQuizParticipate';
// NO wheel config sync
```

### B. **HybridSidebar - Onglets Disponibles**

#### DesignEditor
```tsx
const allTabs = [
  { id: 'background', label: 'Design', icon: Palette },
  { id: 'elements', label: '√âl√©ments', icon: Plus },
  { id: 'form', label: 'Formulaire', icon: FormInput },
  { id: 'game', label: 'Jeu', icon: Gamepad2 },
  { id: 'messages', label: 'Sortie', icon: MessageSquare }
];
```

#### QuizEditor
```tsx
const allTabs = [
  { id: 'background', label: 'Design', icon: Palette },
  { id: 'elements', label: '√âl√©ments', icon: Plus },
  { id: 'form', label: 'Formulaire', icon: FormInput },
  { id: 'game', label: 'Jeu', icon: Gamepad2 }
  // ‚ùå PAS de 'messages'
];
```

#### ModelEditor, JackpotEditor, ScratchCardEditor
- **√Ä v√©rifier** - Probablement similaires mais avec variations

### C. **Panneaux de Jeu (Game Tab)**

#### DesignEditor
```tsx
case 'game':
  return (
    <div className="h-full overflow-y-auto">
      <QuizManagementPanel 
        campaign={campaign}
        setCampaign={setCampaign}
      />
    </div>
  );
```

#### QuizEditor
```tsx
case 'game':
  return (
    <div className="h-full overflow-y-auto">
      <QuizManagementPanel 
        campaign={campaign}
        setCampaign={setCampaign}
      />
    </div>
  );
```

#### ScratchCardEditor
- **Probablement**: `ScratchCardGamePanel` au lieu de `QuizManagementPanel`

#### JackpotEditor
- **Probablement**: `JackpotGamePanel` au lieu de `QuizManagementPanel`

### D. **Hooks Utilis√©s**

| Hook | DesignEditor | QuizEditor | ModelEditor | JackpotEditor | ScratchCardEditor |
|------|--------------|------------|-------------|---------------|-------------------|
| `useWheelConfigSync` | ‚úÖ | ‚ùå | ‚ùå | ‚ùå | ‚ùå |
| `useEditorPreviewSync` | ‚ùå | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| `useKeyboardShortcuts` | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| `useUndoRedo` | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| `useGroupManager` | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| `useScratchCardStore` | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |

### E. **Composants de Preview**

| √âditeur | Composant Preview |
|---------|-------------------|
| DesignEditor | `PreviewRenderer` |
| QuizEditor | `PreviewRenderer` |
| ModelEditor | `FunnelUnlockedGame` |
| JackpotEditor | `FunnelUnlockedGame` + `FunnelQuizParticipate` |
| ScratchCardEditor | `FunnelUnlockedGame` + `FunnelQuizParticipate` |

### F. **Lazy Loading**

#### DesignEditor & QuizEditor
```tsx
const HybridSidebar = lazy(() => import('./HybridSidebar'));
const DesignToolbar = lazy(() => import('./DesignToolbar'));
const DesignCanvas = lazy(() => import('./DesignCanvas'));
const MobileStableEditor = lazy(() => import('./components/MobileStableEditor'));
const KeyboardShortcutsHelp = lazy(() => import('../shared/KeyboardShortcutsHelp'));
```

#### ModelEditor
```tsx
const HybridSidebar = lazy(() => import('./HybridSidebar'));
const DesignToolbar = lazy(() => import('./DesignToolbar'));
// ‚ùå DesignCanvas NOT lazy
import DesignCanvas from './DesignCanvas';
```

### G. **Configurations Sp√©cifiques**

#### QuizEditor & JackpotEditor & ScratchCardEditor
```tsx
const LAUNCH_BUTTON_FALLBACK_GRADIENT = '#000000';
const LAUNCH_BUTTON_DEFAULT_TEXT_COLOR = '#ffffff';
const LAUNCH_BUTTON_DEFAULT_PADDING = '14px 28px';
const LAUNCH_BUTTON_DEFAULT_SHADOW = '0 4px 12px rgba(0, 0, 0, 0.15)';

const buildLaunchButtonStyles = (...) => { ... }
```

#### DesignEditor & ModelEditor
- **Pas de** `buildLaunchButtonStyles`

#### ScratchCardEditor
```tsx
const SCRATCH_DEFAULT_COLOR = '#C0C0C0';
const transformScratchStateToGameConfig = (state?: any) => { ... }
```

## üéØ Architecture de R√©f√©rence Unifi√©e

### 1. **Structure de Fichiers Standard**
```
EditorName/
‚îú‚îÄ‚îÄ EditorNameLayout.tsx          # Layout principal
‚îú‚îÄ‚îÄ HybridSidebar.tsx             # Sidebar unifi√©e
‚îú‚îÄ‚îÄ DesignToolbar.tsx             # Toolbar unifi√©e
‚îú‚îÄ‚îÄ DesignCanvas.tsx              # Canvas unifi√©
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ MobileStableEditor.tsx    # Mobile wrapper
‚îÇ   ‚îî‚îÄ‚îÄ ZoomSlider.tsx            # Contr√¥le zoom
‚îú‚îÄ‚îÄ panels/
‚îÇ   ‚îú‚îÄ‚îÄ GamePanel.tsx             # Panneau jeu sp√©cifique
‚îÇ   ‚îú‚îÄ‚îÄ ConfigPanel.tsx           # Configuration
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îú‚îÄ‚îÄ ImageModulePanel.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ButtonModulePanel.tsx
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ hooks/
    ‚îî‚îÄ‚îÄ useEditorSpecific.ts      # Hooks sp√©cifiques
```

### 2. **Imports Standardis√©s**
```tsx
// Router (TOUJOURS via adapter)
import { useLocation, useNavigate } from '@/lib/router-adapter';

// Hooks communs
import { useKeyboardShortcuts } from '../ModernEditor/hooks/useKeyboardShortcuts';
import { useUndoRedo, useUndoRedoShortcuts } from '../../hooks/useUndoRedo';
import { useGroupManager } from '../../hooks/useGroupManager';
import { getDeviceDimensions } from '../../utils/deviceDimensions';
import { getEditorDeviceOverride } from '@/utils/deviceOverrides';

// Store
import { useEditorStore } from '../../stores/editorStore';
import { useCampaigns } from '@/hooks/useCampaigns';
import { createSaveAndContinueHandler, saveCampaignToDB } from '@/hooks/useModernCampaignEditor/saveHandler';

// Composants partag√©s (lazy)
const HybridSidebar = lazy(() => import('./HybridSidebar'));
const DesignToolbar = lazy(() => import('./DesignToolbar'));
const DesignCanvas = lazy(() => import('./DesignCanvas'));
const MobileStableEditor = lazy(() => import('./components/MobileStableEditor'));
const KeyboardShortcutsHelp = lazy(() => import('../shared/KeyboardShortcutsHelp'));

// Preview (conditionnel selon type)
import PreviewRenderer from '@/components/preview/PreviewRenderer'; // Pour Design/Quiz
// OU
const FunnelUnlockedGame = lazy(() => import('@/components/funnels/FunnelUnlockedGame')); // Pour autres
```

### 3. **Onglets HybridSidebar Standard**
```tsx
const allTabs = [
  { id: 'background', label: 'Design', icon: Palette },
  { id: 'elements', label: '√âl√©ments', icon: Plus },
  { id: 'form', label: 'Formulaire', icon: FormInput },
  { id: 'game', label: 'Jeu', icon: Gamepad2 },
  { id: 'messages', label: 'Sortie', icon: MessageSquare }
];
```

### 4. **Hooks Standard par √âditeur**

#### Tous les √©diteurs
- `useKeyboardShortcuts`
- `useUndoRedo`
- `useUndoRedoShortcuts`
- `useGroupManager`
- `useEditorStore`
- `useCampaigns`

#### √âditeurs avec roue
- `useWheelConfigSync` (DesignEditor uniquement pour l'instant)

#### √âditeurs avec quiz
- `useEditorPreviewSync` (QuizEditor)

#### √âditeurs sp√©cifiques
- `useScratchCardStore` (ScratchCardEditor)

### 5. **Panneaux de Modules Standard**
```tsx
// Tous les √©diteurs doivent avoir:
- ImageModulePanel
- LogoModulePanel
- FooterModulePanel
- ButtonModulePanel
- VideoModulePanel
- SocialModulePanel
- HtmlModulePanel
- CartePanel
```

### 6. **Panneaux Sp√©ciaux Standard**
```tsx
// Tous les √©diteurs doivent avoir:
- BackgroundPanel (Design)
- CompositeElementsPanel (√âl√©ments)
- TextEffectsPanel (Effets)
- TextAnimationsPanel (Animations)
- PositionPanel (Position)
- ModernFormTab (Formulaire)
- MessagesPanel (Sortie)

// Sp√©cifique au type de jeu:
- QuizManagementPanel (Quiz)
- GameManagementPanel (Roue)
- ScratchCardGamePanel (Scratch)
- JackpotGamePanel (Jackpot)
```

## üìã Plan d'Harmonisation

### Phase 1: Standardisation des Imports
- [ ] Tous les √©diteurs utilisent `@/lib/router-adapter`
- [ ] Tous les √©diteurs ont les m√™mes lazy imports
- [ ] Tous les √©diteurs importent les m√™mes hooks de base

### Phase 2: Standardisation des HybridSidebar
- [ ] Tous les √©diteurs ont les 5 onglets standard
- [ ] Tous les √©diteurs ont les m√™mes panneaux de modules
- [ ] Tous les √©diteurs ont la m√™me logique de collapse/expand

### Phase 3: Standardisation des DesignToolbar
- [ ] M√™me interface
- [ ] M√™mes boutons
- [ ] M√™me logique de device selector

### Phase 4: Standardisation des DesignCanvas
- [ ] M√™me syst√®me de drag & drop
- [ ] M√™me syst√®me de s√©lection
- [ ] M√™me syst√®me de zoom

### Phase 5: Standardisation des Composants Partag√©s
- [ ] MobileStableEditor identique partout
- [ ] ZoomSlider identique partout
- [ ] KeyboardShortcutsHelp identique partout

### Phase 6: Hooks Sp√©cifiques
- [ ] Identifier quels hooks doivent √™tre partag√©s
- [ ] Cr√©er des hooks conditionnels pour fonctionnalit√©s sp√©cifiques

### Phase 7: Tests
- [ ] Tester chaque √©diteur individuellement
- [ ] V√©rifier la coh√©rence entre tous les √©diteurs
- [ ] Valider les fonctionnalit√©s sp√©cifiques

## üö® Points d'Attention

### 1. **Router Adapter**
- DesignEditor et QuizEditor utilisent `@/lib/router-adapter`
- ModelEditor, JackpotEditor, ScratchCardEditor utilisent `react-router-dom` directement
- **Action**: Migrer tous vers `@/lib/router-adapter`

### 2. **Preview Components**
- DesignEditor et QuizEditor utilisent `PreviewRenderer`
- Autres utilisent `FunnelUnlockedGame`
- **Action**: Standardiser ou rendre conditionnel

### 3. **Lazy Loading**
- ModelEditor n'a pas DesignCanvas en lazy
- **Action**: Uniformiser le lazy loading

### 4. **Panneaux de Jeu**
- Chaque √©diteur a son propre panneau de jeu
- **Action**: Cr√©er une interface commune

### 5. **Messages Tab**
- DesignEditor a l'onglet Messages
- QuizEditor ne l'a pas
- **Action**: Ajouter partout ou rendre optionnel

## üé® Composants √† Cr√©er/Partager

### 1. **BaseEditorLayout**
Un composant de base dont tous les layouts h√©ritent:
```tsx
interface BaseEditorLayoutProps {
  editorType: 'design' | 'quiz' | 'model' | 'jackpot' | 'scratch';
  mode?: 'template' | 'campaign';
  hiddenTabs?: string[];
  gamePanel?: React.ComponentType<any>;
  previewComponent?: React.ComponentType<any>;
}
```

### 2. **UnifiedHybridSidebar**
Une sidebar qui s'adapte au type d'√©diteur:
```tsx
interface UnifiedHybridSidebarProps extends BaseHybridSidebarProps {
  editorType: 'design' | 'quiz' | 'model' | 'jackpot' | 'scratch';
  gamePanelComponent?: React.ComponentType<any>;
}
```

### 3. **EditorHooksProvider**
Un provider qui fournit tous les hooks n√©cessaires:
```tsx
<EditorHooksProvider editorType="quiz">
  {children}
</EditorHooksProvider>
```

## üìä Matrice de Compatibilit√©

| Fonctionnalit√© | Design | Quiz | Model | Jackpot | Scratch |
|----------------|--------|------|-------|---------|---------|
| Router Adapter | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| Lazy Loading | ‚úÖ | ‚úÖ | ‚ö†Ô∏è | ‚ö†Ô∏è | ‚ö†Ô∏è |
| 5 Onglets | ‚úÖ | ‚ùå | ? | ? | ? |
| Wheel Sync | ‚úÖ | ‚ùå | ‚ùå | ‚ùå | ‚ùå |
| Preview Sync | ‚ùå | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| Messages Panel | ‚úÖ | ‚ùå | ? | ? | ? |
| Module Panels | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |

## üéØ Objectif Final

**Tous les √©diteurs doivent avoir**:
1. ‚úÖ M√™me structure de fichiers
2. ‚úÖ M√™mes imports standardis√©s
3. ‚úÖ M√™mes 5 onglets (Design, √âl√©ments, Formulaire, Jeu, Sortie)
4. ‚úÖ M√™mes panneaux de modules
5. ‚úÖ M√™mes hooks de base
6. ‚úÖ M√™me syst√®me de lazy loading
7. ‚úÖ M√™me logique de device detection
8. ‚úÖ M√™me syst√®me de zoom
9. ‚úÖ M√™me syst√®me de drag & drop
10. ‚úÖ M√™me syst√®me de s√©lection
11. ‚úÖ M√™me syst√®me de groupes
12. ‚úÖ M√™me syst√®me d'undo/redo
13. ‚úÖ M√™me syst√®me de raccourcis clavier
14. ‚úÖ Panneau de jeu sp√©cifique mais interface commune
15. ‚úÖ Preview component adapt√© au type mais interface commune
